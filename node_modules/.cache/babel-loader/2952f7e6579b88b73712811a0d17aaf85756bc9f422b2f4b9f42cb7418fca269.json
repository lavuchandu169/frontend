{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import\"./ViewDocument.css\";import{setLoginUser}from\"../redux/loginSlice\";import io from\"socket.io-client\";import{useNavigate}from\"react-router-dom\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const socket=io.connect(\"https://server-y7e1.onrender.com\");const ViewDocument=()=>{const currentUser=useSelector(state=>state.login.loginUser);const[content,setContent]=useState(\"\");const currentDocument=useSelector(state=>state.documents.currentDocument);const navigate=useNavigate();const dispatch=useDispatch();const[roomMessage,setRoomMessage]=useState(\"\");const joinRoom=()=>{if(currentDocument.fileId!==\"\"){socket.emit(\"join_room\",{fileId:currentDocument.fileId,userId:currentUser});}};const sendMessage=content=>{socket.emit(\"send_message\",{userId:currentUser,fileId:currentDocument.fileId,content:content});};useEffect(()=>{socket.on(\"receive_message\",data=>{if(data.roomMessage){setRoomMessage(data.roomMessage);sendMessage(content);}if(data.userId&&data.newContent){setContent(data.newContent);}});},[socket]);useEffect(()=>{if(!currentDocument){let goToDashboard=()=>navigate(\"/dashboard\");goToDashboard();}fetch(\"https://backend-7ksj.onrender.com/verifyUser\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({user:localStorage.getItem(\"user\")})}).then(res=>{if(res.status===200){res.json().then(res=>{dispatch(setLoginUser(res.userId));if(currentDocument){fetch(\"https://backend-7ksj.onrender.com/getDocumentContent\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\"},body:JSON.stringify({userId:currentDocument.ownerName,fileId:currentDocument.fileId})}).then(res=>{if(res.status===200){res.json().then(res=>{setContent(res.fileContent);joinRoom();});}else{res.json().then(res=>{alert(res.message);});}}).catch(err=>{alert(\"Failed to fetch the document content due to : \\n\",err.message);});}});}else{let goToLogin=()=>navigate(\"/login\");goToLogin();dispatch(setLoginUser(\"\"));}}).catch(err=>{alert(err.message);});},[]);if(!currentDocument){return/*#__PURE__*/_jsx(\"div\",{children:\"No document selected\"});}return/*#__PURE__*/_jsxs(\"div\",{className:\"view-document flex flex-col justify-center items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\" w-full flex justify-center items-center gap-10\",children:[/*#__PURE__*/_jsx(\"div\",{children:\"Document Viewer\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"File Name:\"}),\" \",currentDocument.fileName]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"File ID:\"}),\" \",currentDocument.fileId]}),currentDocument.ownerName&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Owner:\"}),\" \",currentDocument.ownerName]}),roomMessage.length!==0?/*#__PURE__*/_jsx(\"p\",{children:roomMessage}):/*#__PURE__*/_jsx(_Fragment,{}),currentDocument.sharedUsers&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Shared With:\"}),/*#__PURE__*/_jsx(\"ul\",{children:currentDocument.sharedUsers.map((user,index)=>/*#__PURE__*/_jsxs(\"li\",{children:[user.userId,\" - \",user.permissions.join(\", \")]},index))})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"viewer w-full\",children:/*#__PURE__*/_jsx(\"textarea\",{className:\"viewer-textarea\",value:content,readOnly:true})})]});};export default ViewDocument;","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useSelector","setLoginUser","io","useNavigate","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","socket","connect","ViewDocument","currentUser","state","login","loginUser","content","setContent","currentDocument","documents","navigate","dispatch","roomMessage","setRoomMessage","joinRoom","fileId","emit","userId","sendMessage","on","data","newContent","goToDashboard","fetch","method","headers","body","JSON","stringify","user","localStorage","getItem","then","res","status","json","ownerName","fileContent","alert","message","catch","err","goToLogin","children","className","fileName","length","sharedUsers","map","index","permissions","join","value","readOnly"],"sources":["/workspaces/frontend/src/components/ViewDocument.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport \"./ViewDocument.css\";\r\nimport { setLoginUser } from \"../redux/loginSlice\";\r\nimport io from \"socket.io-client\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nconst socket = io.connect(\"https://server-y7e1.onrender.com\");\r\n\r\nconst ViewDocument = () => {\r\n  const currentUser = useSelector((state) => state.login.loginUser);\r\n  const [content, setContent] = useState(\"\");\r\n  const currentDocument = useSelector(\r\n    (state) => state.documents.currentDocument\r\n  );\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  const [roomMessage, setRoomMessage] = useState(\"\");\r\n\r\n  const joinRoom = () => {\r\n    if (currentDocument.fileId !== \"\") {\r\n      socket.emit(\"join_room\", {\r\n        fileId: currentDocument.fileId,\r\n        userId: currentUser,\r\n      });\r\n    }\r\n  };\r\n\r\n  const sendMessage = (content) => {\r\n    socket.emit(\"send_message\", {\r\n      userId: currentUser,\r\n      fileId: currentDocument.fileId,\r\n      content: content,\r\n    });\r\n  };\r\n\r\n  useEffect(() => {\r\n    socket.on(\"receive_message\", (data) => {\r\n      if (data.roomMessage) {\r\n        setRoomMessage(data.roomMessage);\r\n        sendMessage(content);\r\n      }\r\n      if (data.userId && data.newContent) {\r\n        setContent(data.newContent);\r\n      }\r\n    });\r\n  }, [socket]);\r\n\r\n  useEffect(() => {\r\n    if (!currentDocument) {\r\n      let goToDashboard = () => navigate(\"/dashboard\");\r\n      goToDashboard();\r\n    }\r\n    fetch(\"https://backend-7ksj.onrender.com/verifyUser\", {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({ user: localStorage.getItem(\"user\") }),\r\n    })\r\n      .then((res) => {\r\n        if (res.status === 200) {\r\n          res.json().then((res) => {\r\n            dispatch(setLoginUser(res.userId));\r\n            if (currentDocument) {\r\n              fetch(\"https://backend-7ksj.onrender.com/getDocumentContent\", {\r\n                method: \"POST\",\r\n                headers: {\r\n                  \"Content-Type\": \"application/json\",\r\n                },\r\n                body: JSON.stringify({\r\n                  userId: currentDocument.ownerName,\r\n                  fileId: currentDocument.fileId,\r\n                }),\r\n              })\r\n                .then((res) => {\r\n                  if (res.status === 200) {\r\n                    res.json().then((res) => {\r\n                      setContent(res.fileContent);\r\n                      joinRoom();\r\n                    });\r\n                  } else {\r\n                    res.json().then((res) => {\r\n                      alert(res.message);\r\n                    });\r\n                  }\r\n                })\r\n                .catch((err) => {\r\n                  alert(\r\n                    \"Failed to fetch the document content due to : \\n\",\r\n                    err.message\r\n                  );\r\n                });\r\n            }\r\n          });\r\n        } else {\r\n          let goToLogin = () => navigate(\"/login\");\r\n          goToLogin();\r\n          dispatch(setLoginUser(\"\"));\r\n        }\r\n      })\r\n      .catch((err) => {\r\n        alert(err.message);\r\n      });\r\n  }, []);\r\n\r\n  if (!currentDocument) {\r\n    return <div>No document selected</div>;\r\n  }\r\n\r\n  return (\r\n    <div className=\"view-document flex flex-col justify-center items-center\">\r\n      <div className=\" w-full flex justify-center items-center gap-10\">\r\n        <div>Document Viewer</div>\r\n        <div>\r\n          <strong>File Name:</strong> {currentDocument.fileName}\r\n        </div>\r\n        <div>\r\n          <strong>File ID:</strong> {currentDocument.fileId}\r\n        </div>\r\n        {currentDocument.ownerName && (\r\n          <div>\r\n            <strong>Owner:</strong> {currentDocument.ownerName}\r\n          </div>\r\n        )}\r\n        {roomMessage.length !== 0 ? <p>{roomMessage}</p> : <></>}\r\n        {currentDocument.sharedUsers && (\r\n          <div>\r\n            <strong>Shared With:</strong>\r\n            <ul>\r\n              {currentDocument.sharedUsers.map((user, index) => (\r\n                <li key={index}>\r\n                  {user.userId} - {user.permissions.join(\", \")}\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </div>\r\n        )}\r\n      </div>\r\n      <div className=\"viewer w-full\">\r\n        <textarea\r\n          className=\"viewer-textarea\"\r\n          value={content}\r\n          readOnly\r\n        ></textarea>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ViewDocument;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}